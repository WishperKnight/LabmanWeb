<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Track - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        body { display: none; } 
    </style>
</head>
<body>

    <nav class="navbar navbar-dark bg-dark p-3">
        <span class="navbar-brand">Lab Track Dashboard</span>
        <button id="btnLogout" class="btn btn-outline-light btn-sm">Cerrar Sesión</button>
    </nav>

    <div class="container mt-5">
        <h1>Bienvenido, <span id="userEmail"></span></h1>
        <p>Este es el panel de control de tu laboratorio.</p>
        </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Tu misma configuración de Lab Manager
        const firebaseConfig = {
            apiKey: "AIzaSyA_aXLKh1HXcXGD1_s7mA7VuCPsSm1IBPA",
            authDomain: "labmanager-b85b1.firebaseapp.com",
            projectId: "labmanager-b85b1",
            storageBucket: "labmanager-b85b1.firebasestorage.app",
            messagingSenderId: "651630503448",
            appId: "1:651630503448:web:9a327cbf30b84fd763c56d"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // --- PROTECCIÓN DE RUTA ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Usuario está logueado
                console.log("Acceso concedido:", user.email);
                document.getElementById('userEmail').textContent = user.email;
                document.body.style.display = "block"; // Mostramos la página
            } else {
                // No hay usuario, mandarlo al login
                console.log("Acceso denegado, redirigiendo...");
                window.location.href = "index.html"; 
            }
        });

        // --- CERRAR SESIÓN ---
        document.getElementById('btnLogout').addEventListener('click', () => {
            signOut(auth).then(() => {
                window.location.href = "index.html";
            }).catch((error) => {
                alert("Error al cerrar sesión");
            });
        });
    </script>
</body>
</html>